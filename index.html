<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–∞–∫–æ–π —Ç—ã —Ä–æ–¥–∏—Ç–µ–ª—å –≤ —à–∫–æ–ª—å–Ω–æ–º —á–∞—Ç–µ?</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0; background:#0b0c10; color:#eaeaea}
    .wrap{max-width:720px; margin:0 auto; padding:16px}
    .card{background:#14161c; border:1px solid #222533; border-radius:16px; padding:16px; margin:12px 0}
    h1{font-size:22px; margin:0 0 6px}
    .muted{opacity:.78; font-size:13px; line-height:1.35}
    .q{font-size:18px; line-height:1.25; margin:0 0 12px}
    .btn{width:100%; text-align:left; border:1px solid #2a2f40; background:#10121a; color:#eaeaea;
         border-radius:14px; padding:12px 12px; margin:8px 0; cursor:pointer; font-size:15px; line-height:1.25}
    .btn:hover{border-color:#3a415a}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .pill{background:#1b1f2b; border:1px solid #2a2f40; border-radius:999px; padding:6px 10px; font-size:12px; opacity:.9}
    .actions{display:flex; gap:10px; flex-wrap:wrap}
    .primary{background:#2b5cff; border-color:#2b5cff}
    .primary:hover{filter:brightness(1.05)}
    .small{font-size:13px}
    a{color:#8fb3ff}

    /* avatars */
    .avatarRow{display:flex; align-items:center; gap:12px}
    .avatar{
      width:64px; height:64px; border-radius:999px;
      border:1px solid #2a2f40;
      background:#0f1118;
      display:flex; align-items:center; justify-content:center;
      overflow:hidden; flex:0 0 64px;
      box-shadow:0 10px 25px rgba(0,0,0,.25);
    }
    .typeTag{font-size:12px; opacity:.8; margin-top:4px}
    .divider{height:1px; background:#222533; margin:14px 0}

    /* toggle */
    .toggle{display:flex; align-items:center; gap:10px; margin-top:10px}
    .switch{position:relative; width:48px; height:28px; background:#1b1f2b; border:1px solid #2a2f40; border-radius:999px; cursor:pointer}
    .knob{position:absolute; top:3px; left:3px; width:22px; height:22px; border-radius:999px; background:#9aa4b2; transition:all .15s ease}
    .switch.on{background:#2b5cff; border-color:#2b5cff}
    .switch.on .knob{left:23px; background:white}
    .toggleLabel{font-size:13px; opacity:.9}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="screen-start">
      <h1>–ö–∞–∫–æ–π —Ç—ã —Ä–æ–¥–∏—Ç–µ–ª—å –≤ —à–∫–æ–ª—å–Ω–æ–º —á–∞—Ç–µ?</h1>
      <div class="muted">–¢–µ—Å—Ç –Ω–∞ 35 —Å–µ–∫—É–Ω–¥. –£–∑–Ω–∞–µ—à—å —Å–µ–±—è ‚Äî –∏ —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Å—ã–ª–∞–µ—à—å –≤ —á–∞—Ç üòà</div>

      <div class="toggle">
        <div class="switch" id="toxicSwitch" role="switch" aria-checked="false">
          <div class="knob"></div>
        </div>
        <div class="toggleLabel" id="toxicLabel">–†–µ–∂–∏–º —Ç–æ–∫—Å–∏–∫: OFF</div>
        <div class="pill" id="speedPill">5 –≤–æ–ø—Ä–æ—Å–æ–≤</div>
      </div>

      <div style="height:12px"></div>
      <button class="btn primary" id="startBtn" onclick="startTest()">üöÄ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>

      <div class="muted small" id="userHint" style="margin-top:10px"></div>
      <div class="muted small" id="errBox" style="margin-top:10px; white-space:pre-wrap;"></div>
    </div>

    <div class="card" id="screen-quiz" style="display:none">
      <div class="row" style="justify-content:space-between; align-items:center">
        <div class="pill" id="progressPill">–í–æ–ø—Ä–æ—Å 1/5</div>
        <div class="pill" id="microPill">–µ—â—ë 4 –∫–ª–∏–∫–∞ –¥–æ –¥–∏–∞–≥–Ω–æ–∑–∞</div>
      </div>
      <div style="height:12px"></div>
      <div class="q" id="qText"></div>
      <div id="answers"></div>
    </div>

    <div class="card" id="screen-result" style="display:none">
      <h1 id="rTitle">–¢—ã ‚Äî ...</h1>
      <div class="muted" id="rSubtitle"></div>

      <div style="height:12px"></div>
      <div class="card" style="margin:0; background:#10121a" id="rBody"></div>

      <div style="height:12px"></div>
      <div class="actions">
        <button class="btn primary" id="shareBtn">üì£ –ü–µ—Ä–µ—Å–ª–∞—Ç—å –≤ —à–∫–æ–ª—å–Ω—ã–π —á–∞—Ç</button>
        <button class="btn" id="memeBtn">üßæ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π –º–µ–º</button>
        <button class="btn" id="restartBtn">üîÅ –ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>
        <button class="btn" id="ctaBtn">üéØ –£–∑–Ω–∞—Ç—å –ø—Ä–æ –ê–π–î–∞–ö–µ–º–ø</button>
      </div>

      <div class="muted small" style="margin-top:10px">
        –ü–æ–¥–µ–ª–∏—Ç—å—Å—è: –º—ã –∫–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –≤ –±—É—Ñ–µ—Ä. –°–∫—Ä–∏–Ω —Ç–æ–∂–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è üòâ
      </div>
    </div>
  </div>

<script>
  const tg = window.Telegram?.WebApp;
  try {
    if (tg) {
      tg.expand();
      tg.ready();
      tg.setHeaderColor?.("#0b0c10");
      tg.setBackgroundColor?.("#0b0c10");
    }
  } catch (e) {}

  // ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏
  const BOT_USERNAME = "schoolchat1_bot";     // @schoolchat1_bot
  const CTA_URL = "https://aidacamp.ru/";     // –ê–π–î–∞–ö–µ–º–ø
  const APP_DEEPLINK = () => `https://t.me/${BOT_USERNAME}?startapp=schoolchat`;

  // ===== UI refs =====
  const screens = {
    start: document.getElementById("screen-start"),
    quiz: document.getElementById("screen-quiz"),
    result: document.getElementById("screen-result"),
  };

  const qText = document.getElementById("qText");
  const answersEl = document.getElementById("answers");
  const progressPill = document.getElementById("progressPill");
  const microPill = document.getElementById("microPill");
  const userHint = document.getElementById("userHint");

  const rTitle = document.getElementById("rTitle");
  const rSubtitle = document.getElementById("rSubtitle");
  const rBody = document.getElementById("rBody");

  const shareBtn = document.getElementById("shareBtn");
  const memeBtn = document.getElementById("memeBtn");
  const restartBtn = document.getElementById("restartBtn");
  const ctaBtn = document.getElementById("ctaBtn");

  const toxicSwitch = document.getElementById("toxicSwitch");
  const toxicLabel = document.getElementById("toxicLabel");

  // ===== Visible error log =====
  const errBox = document.getElementById("errBox");
  function logErr(msg){
    if (!errBox) return;
    errBox.textContent += (errBox.textContent ? "\n" : "") + msg;
  }
  window.onerror = (msg) => logErr("JS error: " + msg);
  window.onunhandledrejection = (e) => logErr("Promise error: " + (e.reason?.message || e.reason || "unknown"));

  // ===== Types (expanded descriptions) =====
  const TYPES = [
    {
      id:"investor",
      name:"–†–æ–¥–∏—Ç–µ–ª—å-–ò–Ω–≤–µ—Å—Ç–æ—Ä",
      meme:"¬´–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ = –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–±—ë–Ω–∫–∞¬ª",
      short:"–Ø ‚Äî üìà –†–æ–¥–∏—Ç–µ–ª—å-–ò–Ω–≤–µ—Å—Ç–æ—Ä. –Ø –ø–æ–∫—É–ø–∞—é —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é, –∞ –Ω–µ —Å–∫–∏–¥–∫—É.",
      soft:{
        title:"–¢—ã –ø–æ–∫—É–ø–∞–µ—à—å –ù–ï –∫—Ä—É–∂–æ–∫ ‚Äî —Ç—ã –ø–æ–∫—É–ø–∞–µ—à—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é.",
        bullets:[
          "–°–º–æ—Ç—Ä–∏—à—å –Ω–∞ –Ω–∞–≤—ã–∫–∏, —Å—Ä–µ–¥—É, –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.",
          "–ù–µ —Ç–æ—Ä–≥—É–µ—à—å—Å—è —Ä–∞–¥–∏ –≥–∞–ª–æ—á–∫–∏ ‚Äî —Ç–æ—Ä–≥—É–µ—à—å—Å—è –∑–∞ —Å–º—ã—Å–ª.",
          "–•–æ—á–µ—à—å —Å–∏–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –∞ –Ω–µ ‚Äú–ø—Ä–æ—Å—Ç–æ –∑–∞–Ω—è—Ç—å‚Äù."
        ],
        strengths:"–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: –¥–∞–ª—å–Ω–æ–∑–æ—Ä–∫–æ—Å—Ç—å –∏ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å.",
        risks:"–†–∏—Å–∫: –∏–Ω–æ–≥–¥–∞ –∑–∞–±—ã–≤–∞–µ—à—å, —á—Ç–æ —Ä–µ–±—ë–Ω–æ–∫ ‚Äî –Ω–µ —Å—Ç–∞—Ä—Ç–∞–ø üôÇ",
        tip:"–¢–µ–±–µ –∑–∞—Ö–æ–¥—è—Ç —Ñ–æ—Ä–º–∞—Ç—ã: –ø—Ä–æ–µ–∫—Ç–Ω–∞—è —Å–º–µ–Ω–∞, –∑–∞—â–∏—Ç–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤, —Å–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∏."
      },
      toxic:{
        title:"–¢—ã: ¬´–≥–¥–µ ROI –∏ –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–±—ë–Ω–∫–∞ –Ω–∞ 3 –≥–æ–¥–∞?¬ª",
        bullets:[
          "–°–Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è. –ü–æ—Ç–æ–º —ç–º–æ—Ü–∏–∏. –ü–æ—Ç–æ–º, –º–æ–∂–µ—Ç –±—ã—Ç—å, —É–ª—ã–±–∫–∞.",
          "–¢—ã –ø–æ–∫—É–ø–∞–µ—à—å —Å—Ä–µ–¥—É, –∞ –Ω–µ ‚Äú–∞–Ω–∏–º–∞—Ü–∏—é‚Äù.",
          "–õ—é–±–∏—à—å, –∫–æ–≥–¥–∞ –≤—Å—ë –º–æ–∂–Ω–æ –∏–∑–º–µ—Ä–∏—Ç—å ‚Äî —Ö–æ—Ç—å –≤ –ø–æ–ø—É–≥–∞—è—Ö."
        ],
        strengths:"–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∏ –≤–∑—Ä–æ—Å–ª–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞.",
        risks:"–†–∏—Å–∫: –º–æ–∂–µ—à—å ‚Äú–ø–µ—Ä–µ–¥–∏–∑–∞–π–Ω–∏—Ç—å‚Äù –¥–µ—Ç—Å—Ç–≤–æ.",
        tip:"–î–∞–π 1 –∑–æ–Ω—É —Å–≤–æ–±–æ–¥—ã: –ø—É—Å—Ç—å —Ä–µ–±—ë–Ω–æ–∫ —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç —á–∞—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π."
      }
    },
    {
      id:"econom",
      name:"–†–æ–¥–∏—Ç–µ–ª—å-–≠–∫–æ–Ω–æ–º",
      meme:"¬´–ê –ø–æ—á–µ–º—É —Ç–∞–∫ –¥–æ—Ä–æ–≥–æ, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —à—Ç–æ—Ä—ã?¬ª",
      short:"–Ø ‚Äî üßÆ –†–æ–¥–∏—Ç–µ–ª—å-–≠–∫–æ–Ω–æ–º. –Ø —Å—Ä–∞–≤–Ω–∏–≤–∞—é –≤—Å—ë, –¥–∞–∂–µ –≤–æ–∑–¥—É—Ö.",
      soft:{
        title:"–¢—ã —É–º–µ–µ—à—å –∑–∞—â–∏—â–∞—Ç—å —Å–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç –∫–∞–∫ —Å–ø–µ—Ü–Ω–∞–∑.",
        bullets:[
          "–°—Ä–∞–≤–Ω–∏–≤–∞–µ—à—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ –∑–∞–¥–∞—ë—à—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ —Ü–µ–Ω–Ω–æ—Å—Ç—å.",
          "–î–æ–ª–≥–æ –≤—ã–±–∏—Ä–∞–µ—à—å ‚Äî –∑–∞—Ç–æ –ø–æ—Ç–æ–º –Ω–µ –∂–∞–ª–µ–µ—à—å.",
          "–õ—é–±–∏—à—å –ø–æ–Ω—è—Ç–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Ü–µ–Ω—ã."
        ],
        strengths:"–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞—Å—Ö–æ–¥–æ–≤.",
        risks:"–†–∏—Å–∫: –º–æ–∂–Ω–æ —É–ø—É—Å—Ç–∏—Ç—å ‚Äú–ª—É—á—à–µ–µ –ø–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—é —Å—Ä–µ–¥–∞/–ø–æ–ª—å–∑–∞‚Äù.",
        tip:"–¢—Ä–∏–≥–≥–µ—Ä: –ø–æ–∫–∞–∑—ã–≤–∞–π –≤—ã–≥–æ–¥—ã –≤ —Ü–∏—Ñ—Ä–∞—Ö –∏ —á—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å."
      },
      toxic:{
        title:"–¢—ã: ¬´–¥–æ—Ä–æ–≥–æ. –∞ –º–æ–∂–Ω–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ?¬ª",
        bullets:[
          "–í–∏–¥–∏—à—å –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∑–∞ –∫–∏–ª–æ–º–µ—Ç—Ä –∏ –Ω–µ –≤–µ–¥—ë—à—å—Å—è.",
          "–£–º–µ–µ—à—å –Ω–∞—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã –≤ —Ç–µ–º–Ω–æ—Ç–µ.",
          "–°–º–µ—Ç–∞ ‚Äî —Ç–≤–æ—è —Ä–µ–ª–∏–≥–∏—è."
        ],
        strengths:"–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: –∑–¥—Ä–∞–≤—ã–π —Å–º—ã—Å–ª –∏ —Ö–æ–ª–æ–¥–Ω–∞—è –≥–æ–ª–æ–≤–∞.",
        risks:"–†–∏—Å–∫: ‚Äú–¥–µ—à–µ–≤–ª–µ‚Äù –∏–Ω–æ–≥–¥–∞ –≤—ã—Ö–æ–¥–∏—Ç –¥–æ—Ä–æ–∂–µ.",
        tip:"–°–º–æ—Ç—Ä–∏ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ü–µ–Ω—É ‚Äî –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å/–ø—Ä–æ–≥—Ä–∞–º–º—É/–∫–æ–º–∞–Ω–¥—É."
      }
    },
    {
      id:"insurer",
      name:"–†–æ–¥–∏—Ç–µ–ª—å-–°—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª—å",
      meme:"¬´–ê–ø—Ç–µ—á–∫–∞ –≥–¥–µ? –ê –∞–ª–ª–µ—Ä–≥–∏—è –Ω–∞ –≤–æ–∑–¥—É—Ö?¬ª",
      short:"–Ø ‚Äî üõ°Ô∏è –†–æ–¥–∏—Ç–µ–ª—å-–°—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª—å. –ú–Ω–µ –Ω—É–∂–µ–Ω —Ä–µ–≥–ª–∞–º–µ–Ω—Ç –∏ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ.",
      soft:{
        title:"–¢—ã –º–µ–Ω–µ–¥–∂–µ—Ä —Ä–∏—Å–∫–æ–≤. –ò —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –≤—Å–µ–º.",
        bullets:[
          "–í–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî –Ω–µ –ø—Ä–∏–¥–∏—Ä–∫–∏, –∞ –∑–∞–±–æ—Ç–∞.",
          "–õ—é–±–∏—à—å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å: —Ñ–æ—Ç–æ/–¥–æ–∫—É–º–µ–Ω—Ç—ã/–∫–æ–Ω—Ç–∞–∫—Ç—ã/–ø—Ä–æ—Ü–µ—Å—Å—ã.",
          "–ü–æ–∫—É–ø–∞–µ—à—å, –∫–æ–≥–¥–∞ –≤—Å—ë –æ–±—ä—è—Å–Ω–µ–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ –∏ –ø–æ –¥–µ–ª—É."
        ],
        strengths:"–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å.",
        risks:"–†–∏—Å–∫: —Ç—Ä–µ–≤–æ–≥–∞ —Å—ä–µ–¥–∞–µ—Ç —Ä–∞–¥–æ—Å—Ç—å.",
        tip:"–¢–µ–±–µ –≤–∞–∂–Ω–æ: —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã, –º–µ–¥—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ, –ø–æ–Ω—è—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞."
      },
      toxic:{
        title:"–¢—ã: ¬´–ø–æ–∫–∞ –Ω–µ —É–≤–∏–∂—É —Ä–µ–≥–ª–∞–º–µ–Ω—Ç ‚Äî —Ä–µ–±—ë–Ω–æ–∫ –Ω–µ –¥—ã—à–∏—Ç¬ª",
        bullets:[
          "–¢—ã –∑–Ω–∞–µ—à—å –≤—Å–µ —Å—Ç—Ä–∞—à–∏–ª–∫–∏ –∏ –≥–æ—Ç–æ–≤(–∞) –∫ –∫–∞–∂–¥–æ–π.",
          "–¢–µ–ª–µ—Ñ–æ–Ω? –ê–ø—Ç–µ—á–∫–∞? –ö–æ–Ω—Ç–∞–∫—Ç—ã? –í—Å—ë –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å.",
          "‚Äú–ê –≤–¥—Ä—É–≥‚Ä¶‚Äù ‚Äî —Ç–≤–æ–π —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å."
        ],
        strengths:"–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ.",
        risks:"–†–∏—Å–∫: –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å –∂–∏—Ç—å –≤ —Ä–µ–∂–∏–º–µ –ß–°.",
        tip:"–ü—Ä–æ—Å–∏ —Ñ–∞–∫—Ç—ã/–¥–æ–∫—É–º–µ–Ω—Ç—ã ‚Äî –∏ –∑–∞–∫—Ä—ã–≤–∞–π –≤–æ–ø—Ä–æ—Å, –Ω–µ –¥–æ–∫—Ä—É—á–∏–≤–∞–π –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ."
      }
    },
    {
      id:"overloaded",
      name:"–†–æ–¥–∏—Ç–µ–ª—å-–ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–π",
      meme:"¬´–°—Å—ã–ª–∫—É. –û–ø–ª–∞—Ç–∏—Ç—å. –ì–æ—Ç–æ–≤–æ.¬ª",
      short:"–Ø ‚Äî ‚ö° –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–π. –î–∞–π—Ç–µ 1 –∫–Ω–æ–ø–∫—É –∏ –Ω–µ –ø–∏—à–∏—Ç–µ –ø—Ä–æ—Å—Ç—ã–Ω—é.",
      soft:{
        title:"–¢—ã –∂–∏–≤—ë—à—å –≤ —Ä–µ–∂–∏–º–µ ‚Äú–ø–æ–∂–∞—Ä ‚Üí —Å–æ–∑–≤–æ–Ω ‚Üí –ø–æ–∂–∞—Ä‚Äù.",
        bullets:[
          "–¢–µ–±–µ –Ω—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∞: –≤—ã–±—Ä–∞—Ç—å ‚Üí –æ–ø–ª–∞—Ç–∏—Ç—å ‚Üí –∑–∞–±—ã—Ç—å.",
          "–¢—ã –ø–æ–∫—É–ø–∞–µ—à—å –±—ã—Å—Ç—Ä–æ, –µ—Å–ª–∏ –ø—É—Ç—å –±–µ–∑ —Ç—Ä–µ–Ω–∏—è.",
          "–°–ª–æ–∂–Ω–æ—Å—Ç—å = –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–π –ª–∏–¥–µ—Ä."
        ],
        strengths:"–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π.",
        risks:"–†–∏—Å–∫: –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–µ—Ç–∞–ª–∏.",
        tip:"–¢–µ–±–µ –∑–∞–π–¥—ë—Ç ‚Äú–ø–æ–¥ –∫–ª—é—á‚Äù: –æ–¥–∏–Ω –º–µ–Ω–µ–¥–∂–µ—Ä, –æ–¥–∏–Ω –ª–∏–Ω–∫, –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ."
      },
      toxic:{
        title:"–¢—ã: ¬´–µ—â—ë –æ–¥–∏–Ω —á–∞—Ç ‚Äî –∏ —è —É—Ö–æ–∂—É –≤ –º–æ–Ω–∞—Å—Ç—ã—Ä—å¬ª",
        bullets:[
          "–¢–µ–∫—Å—Ç –Ω–∞ 40 —Å—Ç—Ä–æ–∫? –¢—ã –Ω–µ –≤–∏–¥–∏—à—å –µ–≥–æ. –¢—ã —á—É–≤—Å—Ç–≤—É–µ—à—å –±–æ–ª—å.",
          "–õ—é–±–∏—à—å, –∫–æ–≥–¥–∞ –≤—Å—ë —Å–¥–µ–ª–∞–Ω–æ –∑–∞ —Ç–µ–±—è.",
          "–ï—Å–ª–∏ –Ω–∞–¥–æ –¥—É–º–∞—Ç—å ‚Äî —Ç—ã —É–∂–µ –Ω–∞ —Å–æ–∑–≤–æ–Ω–µ."
        ],
        strengths:"–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.",
        risks:"–†–∏—Å–∫: –≤—ã–±–æ—Ä ‚Äú–ª–∏—à—å –±—ã –±—ã—Å—Ç—Ä–æ‚Äù –∏–Ω–æ–≥–¥–∞ –∫—É—Å–∞–µ—Ç—Å—è.",
        tip:"–°–æ—Ö—Ä–∞–Ω—è–π 1 —á–µ–∫-–ª–∏—Å—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥ ‚Äî –∏ –≤—Å—ë."
      }
    },
    {
      id:"skeptic",
      name:"–†–æ–¥–∏—Ç–µ–ª—å-–°–∫–µ–ø—Ç–∏–∫",
      meme:"¬´–§–æ—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–µ? –î–æ–∫—É–º–µ–Ω—Ç—ã –≥–¥–µ?¬ª",
      short:"–Ø ‚Äî üïµÔ∏è –°–∫–µ–ø—Ç–∏–∫. –í–µ—Ä—é —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º –∏ –≥–ª–∞–∑–∞–º.",
      soft:{
        title:"–¢—ã –Ω–µ –∑–∞–Ω—É–¥–∞ ‚Äî —Ç—ã —Ñ–∏–ª—å—Ç—Ä –æ—Ç –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞.",
        bullets:[
          "–ü—Ä–æ–≤–µ—Ä—è–µ—à—å –¥–æ–∫—É–º–µ–Ω—Ç—ã, –æ—Ç–∑—ã–≤—ã, —Ñ–∞–∫—Ç—ã –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å.",
          "–ù–µ –≤–µ–¥—ë—à—å—Å—è –Ω–∞ ‚Äú—É –Ω–∞—Å –≤—Å—ë –∫–ª–∞—Å—Å–Ω–æ, —á–µ—Å—Ç–Ω–æ-—á–µ—Å—Ç–Ω–æ‚Äù.",
          "–ö—É–ø–∏–≤ –æ–¥–∏–Ω —Ä–∞–∑ ‚Äî —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è —Å–∞–º—ã–º –ª–æ—è–ª—å–Ω—ã–º."
        ],
        strengths:"–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: –∑–∞—â–∏—Ç–∞ –æ—Ç –µ—Ä—É–Ω–¥—ã.",
        risks:"–†–∏—Å–∫: –º–æ–∂–Ω–æ ‚Äú–Ω–µ –∫—É–ø–∏—Ç—å –Ω–∏–∫–æ–≥–¥–∞‚Äù, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–æ–º–Ω–µ–Ω–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã.",
        tip:"–¢–µ–±–µ –Ω—É–∂–Ω—ã: –¥–æ–≥–æ–≤–æ—Ä, —Ä–µ–µ—Å—Ç—Ä/–¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã, –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞."
      },
      toxic:{
        title:"–¢—ã: ¬´–ø–æ–∫–∞ –Ω–µ –¥–æ–∫–∞–∂–µ—Ç–µ ‚Äî —ç—Ç–æ –≤—Å—ë —Ñ–µ–π–∫¬ª",
        bullets:[
          "–¢—ã –≤–∏–¥–∏—à—å –ø–æ–¥–≤–æ—Ö –¥–∞–∂–µ –≤ —Å–ª–æ–≤–µ ‚Äú–¥–æ–±—Ä—ã–π –¥–µ–Ω—å‚Äù.",
          "–õ—é–±–∏—à—å –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –¥—Ä–æ–∂–∞—Ç –º–µ–Ω–µ–¥–∂–µ—Ä—ã.",
          "–°–ª–æ–≤–∞ –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è. –¢–æ–ª—å–∫–æ —Ñ–∞–∫—Ç—ã."
        ],
        strengths:"–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: —á–µ—Å—Ç–Ω—ã–π –æ—Ç–±–æ—Ä.",
        risks:"–†–∏—Å–∫: –∏–Ω–æ–≥–¥–∞ –≤—ã–∫–∏–¥—ã–≤–∞–µ—à—å —Ö–æ—Ä–æ—à–µ–µ –≤–º–µ—Å—Ç–µ —Å –ø–ª–æ—Ö–∏–º.",
        tip:"–û–ø—Ä–µ–¥–µ–ª–∏ 3 –∫—Ä–∏—Ç–µ—Ä–∏–∏ ‚Äò–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–∫–∞–∑–∞–Ω–æ‚Äô –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è."
      }
    },
  ];

  // ===== SVG avatars (coin style) =====
  const TYPE_SVG = {
    investor: svgCoin("INV", "üìà", "#2b5cff", "#0b1b3a"),
    econom: svgCoin("ECO", "üßÆ", "#00c2a8", "#052a25"),
    insurer: svgCoin("SAFE", "üõ°Ô∏è", "#22c55e", "#062612"),
    overloaded: svgCoin("FAST", "‚ö°", "#f59e0b", "#2a1600"),
    skeptic: svgCoin("PROOF", "üïµÔ∏è", "#f97316", "#2a1206"),
  };

  function svgCoin(label, emoji, accent, deep) {
    return `
<svg width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-label="${label}">
  <defs>
    <radialGradient id="g1-${label}" cx="30%" cy="25%" r="70%">
      <stop offset="0%" stop-color="${accent}" stop-opacity="0.95"/>
      <stop offset="55%" stop-color="${deep}" stop-opacity="0.98"/>
      <stop offset="100%" stop-color="#070812" stop-opacity="1"/>
    </radialGradient>
    <linearGradient id="ring-${label}" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="rgba(255,255,255,.40)"/>
      <stop offset="35%" stop-color="rgba(255,255,255,.10)"/>
      <stop offset="100%" stop-color="rgba(0,0,0,.35)"/>
    </linearGradient>
  </defs>

  <circle cx="32" cy="32" r="29" fill="url(#g1-${label})"/>
  <circle cx="32" cy="32" r="28" fill="none" stroke="url(#ring-${label})" stroke-width="2"/>
  <circle cx="32" cy="32" r="20.5" fill="rgba(0,0,0,.18)" stroke="rgba(255,255,255,.14)" stroke-width="1.2"/>

  <text x="32" y="36" text-anchor="middle" font-size="22" font-family="system-ui,Apple Color Emoji,Segoe UI Emoji">${emoji}</text>
  <text x="32" y="54" text-anchor="middle" font-size="9.5" letter-spacing="1"
        font-family="system-ui,Segoe UI,Roboto,Arial" fill="rgba(255,255,255,.78)">${label}</text>

  <path d="M14 20 C20 10, 38 8, 50 18 C40 14, 26 14, 14 20 Z" fill="rgba(255,255,255,.12)"/>
</svg>`;
  }

  function renderAvatar(typeId){
    const svg = TYPE_SVG[typeId] || svgCoin("TYPE", "üôÇ", "#64748b", "#0b1020");
    return `<div class="avatar">${svg}</div>`;
  }

  // ===== Toxic toggle =====
  let toxicMode = false;
  function setToxic(on){
    toxicMode = !!on;
    if (toxicMode) {
      toxicSwitch.classList.add("on");
      toxicSwitch.setAttribute("aria-checked","true");
      toxicLabel.textContent = "–†–µ–∂–∏–º —Ç–æ–∫—Å–∏–∫: ON";
    } else {
      toxicSwitch.classList.remove("on");
      toxicSwitch.setAttribute("aria-checked","false");
      toxicLabel.textContent = "–†–µ–∂–∏–º —Ç–æ–∫—Å–∏–∫: OFF";
    }
  }
  toxicSwitch.addEventListener("click", () => setToxic(!toxicMode));
  setToxic(false);

  // ===== Questions (5) ‚Äî shorter answers 35‚Äì55 chars =====
  // NOTE: scoring points only for the 5-result MVP types above.
  const QUESTIONS = [
    {
      q: "¬´–°–∫–∏–¥—ã–≤–∞–µ–º—Å—è –Ω–∞ —à—Ç–æ—Ä—ã. 1500 –¥–æ 18:00¬ª",
      a: [
        { t:"–ü—Ä–æ—á–∏—Ç–∞–ª(–∞) ‚Äî –∏—Å—á–µ–∑(–ª–∞). (–ü—Ä–∏–∑—Ä–∞–∫ üëª)", s:{ leave_me:2 } }, // kept for fun, but we don't have type -> will be ignored
        { t:"–ü–µ—Ä–µ–≤—ë–ª(–∞) –∑–∞ 7 —Å–µ–∫. –ù–µ –∑–∞–¥–∞—é –≤–æ–ø—Ä–æ—Å–æ–≤. ‚ö°", s:{ overloaded:2 } },
        { t:"–ì–¥–µ —Å–º–µ—Ç–∞/–ö–ü/—á–µ–∫–∏? –ü–æ—á–µ–º—É 1500 –≤–æ–æ–±—â–µ? üßÆ", s:{ econom:2, skeptic:1 } },
        { t:"–Ø –Ω–∞–π–¥—É –ª—É—á—à–µ: –±–ª—ç–∫–∞—É—Ç, 4.9‚≠ê, –¥–æ—Å—Ç–∞–≤–∫–∞. üìà", s:{ investor:2 } },
        { t:"–ì–ª–∞–≤–Ω–æ–µ: –≥–∏–ø–æ–∞–ª–ª–µ—Ä–≥–µ–Ω–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–µ—Ç—è–º. üõ°Ô∏è", s:{ insurer:2 } },
      ]
    },
    {
      q: "–í —á–∞—Ç –∑–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ—Å—Ç—ã–Ω—è –Ω–∞ 40 —Å—Ç—Ä–æ–∫: ¬´–í–ê–ñ–ù–û!!!¬ª",
      a: [
        { t:"–ß–∏—Ç–∞—é 2 —Å—Ç—Ä–æ–∫–∏. –î–∞–ª—å—à–µ ‚Äî —Ç—É–º–∞–Ω. üï≥Ô∏è", s:{ overloaded:1 } },
        { t:"–ö–æ—Ä–æ—Ç–∫–æ: —á—Ç–æ —Å–¥–µ–ª–∞—Ç—å –∏ –¥–æ –∫–∞–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏? ‚è±Ô∏è", s:{ overloaded:2 } },
        { t:"–í–∏–∂—É –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è. –°–µ–π—á–∞—Å —É—Ç–æ—á–Ω—é –∏ –ø—Ä–æ–≤–µ—Ä—é. üïµÔ∏è", s:{ skeptic:2 } },
        { t:"–ù–∞–π–¥—É 3 —Å—Å—ã–ª–∫–∏ –∏ –æ–±—ä—è—Å–Ω—é, –∫–∞–∫ ‚Äú–ø—Ä–∞–≤–∏–ª—å–Ω–æ‚Äù. üß†", s:{ investor:1 } },
        { t:"–Ø –Ω–∞ —Å–æ–∑–≤–æ–Ω–µ. –í–µ—Ä–Ω—É—Å—å‚Ä¶ –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å. üôÉ", s:{ overloaded:2 } },
      ]
    },
    {
      q: "–£—á–∏—Ç–µ–ª—å: ¬´–í–∞—à —Ä–µ–±—ë–Ω–æ–∫ –æ—Ç–≤–ª–µ–∫–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ¬ª",
      a: [
        { t:"–ó–∞–±–∏—Ä–∞–π—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω. –ò –∑–∞—Ä—è–¥–∫—É —Ç–æ–∂–µ. üõ°Ô∏è", s:{ insurer:2 } },
        { t:"–î–∞–π—Ç–µ —Ñ–∞–∫—Ç—ã: –∫–æ–≥–¥–∞, —Å–∫–æ–ª—å–∫–æ, –¥–∏–Ω–∞–º–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü. üïµÔ∏è", s:{ skeptic:1, investor:1 } },
        { t:"–°—Å—ã–ª–∫—É –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ: –∫—É—Ä—Å/–ª–∞–≥–µ—Ä—å ‚Äî –∏ –∑–∞–∫—Ä—ã–ª–∏. ‚ö°", s:{ overloaded:2 } },
        { t:"–≠—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π —Ä–∏—Å–∫. –ù—É–∂–Ω–∞ —Å—Ä–µ–¥–∞ –∏ –ø—Ä–æ–µ–∫—Ç. üìà", s:{ investor:2 } },
        { t:"–ê –µ—Å—Ç—å –º–µ—Ç–æ–¥–∏–∫–∞? ‚Äú–û—Ç–≤–ª–µ–∫–∞–µ—Ç—Å—è‚Äù ‚Äî –Ω–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å. üßÆ", s:{ econom:1, skeptic:1 } },
      ]
    },
    {
      q: "–í —á–∞—Ç –∫–∏–Ω—É–ª–∏: ¬´IT-–ª–∞–≥–µ—Ä—å. –°–∫–∏–¥–∫–∞ –¥–æ –∑–∞–≤—Ç—Ä–∞¬ª",
      a: [
        { t:"–°—Ä–∞–≤–Ω—é 12 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤. –ù–∞–π–¥—É –¥–µ—à–µ–≤–ª–µ + –ø—Ä–æ–º–æ. üßÆ", s:{ econom:2 } },
        { t:"–ö–∞–∫–∏–µ –Ω–∞–≤—ã–∫–∏/–ø—Ä–æ–µ–∫—Ç—ã/—Å—Ä–µ–¥–∞ –Ω–∞ –≤—ã—Ö–æ–¥–µ? üìà", s:{ investor:2 } },
        { t:"–°—Å—ã–ª–∫–∞ ‚Üí –æ–ø–ª–∞—Ç–∏—Ç—å ‚Üí –Ω–µ –ø–∏—à–∏—Ç–µ –º–Ω–µ –±–æ–ª—å—à–µ. ‚ö°", s:{ overloaded:2 } },
        { t:"–î–æ–∫—É–º–µ–Ω—Ç—ã? —Ñ–æ—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–µ? –¥–æ–≥–æ–≤–æ—Ä? –æ—Ç–∑—ã–≤—ã? üïµÔ∏è", s:{ skeptic:2 } },
        { t:"–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ø—Ä–∞–≤–∏–ª–∞, –º–µ–¥—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ, —Ä–µ–∂–∏–º. üõ°Ô∏è", s:{ insurer:2 } },
      ]
    },
    {
      q: "–¢–≤–æ–π —Ä–µ–∂–∏–º –≤ —à–∫–æ–ª—å–Ω–æ–º —á–∞—Ç–µ ‚Äî —ç—Ç–æ‚Ä¶",
      a: [
        { t:"¬´–°—Å—ã–ª–∫—É. –û–ø–ª–∞—Ç–∏—Ç—å. –ì–æ—Ç–æ–≤–æ.¬ª ‚ö°", s:{ overloaded:2 } },
        { t:"¬´–î–æ–±—Ä—ã–π –¥–µ–Ω—å. –£—Ç–æ—á–Ω–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞‚Ä¶¬ª üïµÔ∏è", s:{ skeptic:2 } },
        { t:"¬´–ê –ø–æ—á–µ–º—É —Ç–∞–∫ –¥–æ—Ä–æ–≥–æ? –î–∞–≤–∞–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã.¬ª üßÆ", s:{ econom:2 } },
        { t:"¬´–ì–¥–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ?¬ª üìà", s:{ investor:2 } },
        { t:"¬´–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å/—Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã/–∫–æ–Ω—Ç–∞–∫—Ç—ã ‚Äî —Å—Ä–∞–∑—É.¬ª üõ°Ô∏è", s:{ insurer:2 } },
      ]
    },
  ];

  // ===== State =====
  let idx = 0;
  let score = {}; // typeId -> points

  function getUserLabel() {
    try {
      const u = tg?.initDataUnsafe?.user;
      if (!u) return "";
      const name = [u.first_name, u.last_name].filter(Boolean).join(" ");
      const uname = u.username ? `@${u.username}` : "";
      return `–¢—ã –≤ Telegram –∫–∞–∫: ${name} ${uname}`.trim();
    } catch { return ""; }
  }

  function show(screen) {
    Object.values(screens).forEach(s => s.style.display = "none");
    screens[screen].style.display = "block";
  }

  function addScore(map) {
    for (const [k,v] of Object.entries(map)) score[k] = (score[k]||0) + v;
  }

  function renderQuestion() {
    const q = QUESTIONS[idx];
    const total = QUESTIONS.length;
    progressPill.textContent = `–í–æ–ø—Ä–æ—Å ${idx+1}/${total}`;
    microPill.textContent = `–µ—â—ë ${Math.max(0,total-(idx+1))} –∫–ª–∏–∫–∞ –¥–æ –¥–∏–∞–≥–Ω–æ–∑–∞`;
    qText.textContent = q.q;

    answersEl.innerHTML = "";
    q.a.forEach((opt) => {
      const b = document.createElement("button");
      b.className = "btn";
      b.textContent = opt.t;
      b.onclick = () => {
        addScore(opt.s);
        idx++;
        if (idx < total) renderQuestion();
        else renderResult();
      };
      answersEl.appendChild(b);
    });
  }

  function top2Types() {
    // only among TYPES we have in MVP
    const entries = TYPES.map(t => [t.id, score[t.id] || 0]);
    entries.sort((a,b)=>b[1]-a[1]);
    const [t1, t2] = entries;
    return { t1, t2 };
  }

  function buildResultText(best, second, delta, short=false) {
    const add = (delta <= 1 && second) ? ` (–∏ —á—É—Ç—å-—á—É—Ç—å ${second.name})` : "";
    if (short) {
      // 1-liner meme
      return `${best.short}${add} üòà  @${BOT_USERNAME}`;
    }
    return `–Ø –ø—Ä–æ—à—ë–ª(–ª–∞) —Ç–µ—Å—Ç ¬´–ö–∞–∫–æ–π —Ç—ã —Ä–æ–¥–∏—Ç–µ–ª—å –≤ —à–∫–æ–ª—å–Ω–æ–º —á–∞—Ç–µ?¬ª üòà
–†–µ–∑—É–ª—å—Ç–∞—Ç: ${best.name}${add}
${best.meme}

–ü—Ä–æ–π–¥–∏ —Ç–æ–∂–µ: ${APP_DEEPLINK()}`;
  }

  function renderResult() {
    const { t1, t2 } = top2Types();
    const best = TYPES.find(x=>x.id===t1[0]) || TYPES[0];
    const second = TYPES.find(x=>x.id===t2[0]) || null;
    const delta = (t1[1] - (t2?.[1] ?? 0));

    const mode = toxicMode ? "toxic" : "soft";
    const d = best[mode];

    rTitle.textContent = `–¢—ã ‚Äî ${best.name}`;
    rSubtitle.textContent = toxicMode ? `–†–µ–∂–∏–º —Ç–æ–∫—Å–∏–∫: ON ‚Ä¢ ${best.meme}` : best.meme;

    const bullets = d.bullets.map(x => `<li style="margin:6px 0">${x}</li>`).join("");

    rBody.innerHTML = `
      <div class="avatarRow">
        ${renderAvatar(best.id)}
        <div>
          <div style="font-size:16px; line-height:1.25; font-weight:750">${d.title}</div>
          <div class="typeTag">${best.meme}</div>
        </div>
      </div>

      <div class="divider"></div>

      <ul style="margin:0; padding-left:18px; font-size:15px; line-height:1.45">
        ${bullets}
      </ul>

      <div class="divider"></div>

      <div style="font-size:14px; line-height:1.45">
        <div><b>${d.strengths}</b></div>
        <div style="margin-top:8px"><b>${d.risks}</b></div>
        <div style="margin-top:10px" class="muted">${d.tip}</div>
      </div>

      ${delta <= 1 && second ? `
        <div class="divider"></div>
        <div class="muted small">–¢—ã –Ω–∞ –≥—Ä–∞–Ω–∏ —Å:</div>
        <div class="avatarRow" style="margin-top:8px">
          ${renderAvatar(second.id)}
          <div>
            <div style="font-size:14px; font-weight:650">${second.name}</div>
            <div class="typeTag">${second.meme}</div>
          </div>
        </div>
      ` : ``}

      <div class="divider"></div>
      <div class="muted small">üì∏ –°–∫—Ä–∏–Ω—å –∏ –∫–∏–¥–∞–π –≤ —á–∞—Ç. –≠—Ç–æ –ª–µ–≥–∞–ª—å–Ω–æ.</div>
      <div class="muted small">üéØ –ê –µ—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äú–≥–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ‚Äù ‚Äî –Ω–∏–∂–µ –∫–Ω–æ–ø–∫–∞ –ê–π–î–∞–ö–µ–º–ø.</div>
    `;

    show("result");

    // Telegram MainButton (optional)
    try {
      if (tg?.MainButton) {
        tg.MainButton.setText("üì£ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è");
        tg.MainButton.show();
        tg.MainButton.onClick(() => doShare(false));
      }
    } catch (e) {}
  }

  async function copyToClipboard(text) {
    await navigator.clipboard.writeText(text);
  }

  async function doShare(short=false) {
    const { t1, t2 } = top2Types();
    const best = TYPES.find(x=>x.id===t1[0]) || TYPES[0];
    const second = TYPES.find(x=>x.id===t2[0]) || null;
    const delta = (t1[1] - (t2?.[1] ?? 0));

    const text = buildResultText(best, second, delta, short);

    try {
      await copyToClipboard(text);
      tg?.showPopup?.({
        title:"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ",
        message: short ? "–ö–æ—Ä–æ—Ç–∫–∏–π –º–µ–º –≤ –±—É—Ñ–µ—Ä–µ. –í—Å—Ç–∞–≤—å –≤ —á–∞—Ç üòà" : "–¢–µ–∫—Å—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –±—É—Ñ–µ—Ä–µ. –í—Å—Ç–∞–≤—å –≤ —á–∞—Ç üòÑ",
        buttons:[{type:"ok"}]
      });
    } catch {
      tg?.showPopup?.({ title:"–ù–µ –≤—ã—à–ª–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å", message:"–°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é –∏ –æ—Ç–ø—Ä–∞–≤—å –≤ —á–∞—Ç.", buttons:[{type:"ok"}] });
    }
  }

  // ‚úÖ Start button handler (HTML onclick)
  window.startTest = function startTest() {
    // reset
    score = {};
    idx = 0;
    errBox.textContent = "";
    show("quiz");
    renderQuestion();
  };

  // Buttons
  shareBtn.onclick = () => doShare(false);
  memeBtn.onclick = () => doShare(true);
  restartBtn.onclick = () => show("start");

  ctaBtn.onclick = () => {
    try {
      if (tg?.openLink) tg.openLink(CTA_URL);
      else window.location.href = CTA_URL;
    } catch {
      window.location.href = CTA_URL;
    }
  };

  // init label
  userHint.textContent = getUserLabel();
</script>
</body>
</html>

